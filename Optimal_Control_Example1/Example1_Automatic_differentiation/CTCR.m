function [F,jac] = CTCR(s,u,th1,th2,th3,ul1,ul2,ul3,Load)
      uhat11=0.5;%PAR(5)%1.0
      uhat12=0.0;
      uhat13=0.0;%PAR(3)
      
      uhat21=0.8;%PAR(6)%2.0
      uhat22=0.0;
      uhat23=0.0;%PAR(3)

      uhat31=1.0;%2.0
      uhat32=0.0;
      uhat33=0.0;%PAR(3)
  
      
     A1=1.0;
     A2=1.2;
     A3=1.4;
     C1=A1/1.3;
     C2=A2/1.3;
     C3=A3/1.3;
     
     L1=ul1;%PAR(1)
     L2=ul2;%PAR(4)
     L3=ul3;%PAR(10)
      	
      m2(1) = (u(7)*u(8) + u(6)*u(9) - u(5)*u(10) - u(4)*u(11))/2.0;
      m2(2) = (-u(6)*u(8) + u(7)*u(9) + u(4)*u(10) - u(5)*u(11))/2.0;
      m2(3) = (u(5)*u(8) - u(4)*u(9) + u(7)*u(10) - u(6)*u(11))/2.0;

%       The 4-vectors D_1[q] n, D_2[q] n, and D_3[q] n contain
%         the same 4 entries, but permuted and possibly negated.
%         Here are those entries

      entry21 =  2.0*(u(4)*u(12) + u(5)*u(13) + u(6)*u(14));
      entry22 =  2.0*(u(5)*u(12) - u(4)*u(13) + u(7)*u(14));
      entry23 =  2.0*(u(6)*u(12) - u(7)*u(13) - u(4)*u(14));
      entry24 =  2.0*(u(7)*u(12) + u(6)*u(13) - u(5)*u(14));

%       Components of D_3[q] n

      d23qn(1) =  entry23;
      d23qn(2) =  entry24;
      d23qn(3) =  entry21;
      d23qn(4) =  entry22;

%       Components of d1

      d21(1)= u(4)*u(4)-u(5)*u(5)-u(6)*u(6)+u(7)*u(7);
      d21(2)= 2.0*u(4)*u(5)+2.0*u(6)*u(7);
      d21(3)= 2.0*u(4)*u(6)-2.0*u(5)*u(7);

%       Components of d2

      d22(1)= 2.0*u(4)*u(5)-2.0*u(6)*u(7);
      d22(2)= -u(4)*u(4)+u(5)*u(5)-u(6)*u(6)+u(7)*u(7);
      d22(3)= 2.0*u(5)*u(6)+2.0*u(4)*u(7);

%       Components of d3

      d23(1)= 2.0*u(4)*u(6)+2.0*u(5)*u(7);
      d23(2)= 2.0*u(5)*u(6)-2.0*u(4)*u(7);
      d23(3)= -u(4)*u(4)-u(5)*u(5)+u(6)*u(6)+u(7)*u(7);

      
	  k21=A1+A2;
	  k22=A1+A2;
      k23=C1+C2;  
    
      ubar21=(A1*uhat11 + A2*(uhat21*cos(u(15)) - uhat22*sin(u(15)) ) )/(A1+A2);
      ubar22=(A1*uhat12 + A2*(uhat21*sin(u(15)) + uhat22*cos(u(15)) ) )/(A1+A2);
      ubar23= -u(16)/C1 + m2(3)*C2/(C1*(C1+C2)) + uhat13;   % Corrected addterm to uhat13
      
      strain2(1) = m2(1)/k21 + ubar21;
      strain2(2) = m2(2)/k22 + ubar22;
      strain2(3) = m2(3)/k23 + ubar23;  %

%    2-tube section    

      F(1) = L2*(d23(1));
      F(2) = L2*(d23(2));
      F(3) = L2*(d23(3));
      F(4) = L2*(strain2(1)*u(7)/2.0 - strain2(2)*u(6)/2.0 + strain2(3)*u(5)/2.0);
      F(5) = L2*(strain2(1)*u(6)/2.0 + strain2(2)*u(7)/2.0 - strain2(3)*u(4)/2.0);
      F(6) = L2*(-strain2(1)*u(5)/2.0 + strain2(2)*u(4)/2.0 + strain2(3)*u(7)/2.0);
      F(7) = L2*(-strain2(1)*u(4)/2.0 - strain2(2)*u(5)/2.0 - strain2(3)*u(6)/2.0);
	  F(8) =L2*(strain2(1)*u(11)/2.0 - strain2(2)*u(10)/2.0 + strain2(3)*u(9)/2.0 -d23qn(1));
	  F(9) =L2*(strain2(1)*u(10)/2.0 + strain2(2)*u(11)/2.0 - strain2(3)*u(8)/2.0 -d23qn(2));
	  F(10) =L2*(-strain2(1)*u(9)/2.0 + strain2(2)*u(8)/2.0 + strain2(3)*u(11)/2.0-d23qn(3));
	  F(11) =L2*(-strain2(1)*u(8)/2.0 - strain2(2)*u(9)/2.0 - strain2(3)*u(10)/2.0-d23qn(4));
      F(12) = L2*0.0;
      F(13) = L2*0.0;
      F(14) = L2*0.0;
      F(15)=  L2*( ( (C1+C2)*u(16)/(C1*C2) ) - (m2(3)/C1) + (uhat23-uhat13) );   % Alpha
      ater1=( m2(1)*sin(u(15)) - m2(2)*cos(u(15)) )*A2*uhat21/(A1+A2); %Corrected -m2(2) to +ve
      ater2=((uhat21*uhat11 + uhat12*uhat22)*sin(u(15)) + (uhat11*uhat22 - uhat12*uhat21)*cos(u(15)))*A1*A2/(A1+A2);
      F(16) = L2*(ater1+ater2);  
   
      
      k11=A1;
      k12=A1;
      k13=C1;
     
      m1(1) = (u(23)*u(24) + u(22)*u(25) - u(21)*u(26) - u(20)*u(27))/2.0;
      m1(2) = (-u(22)*u(24) + u(23)*u(25) + u(20)*u(26) - u(21)*u(27))/2.0;
      m1(3) = (u(21)*u(24) - u(20)*u(25) + u(23)*u(26) - u(22)*u(27))/2.0;

%       The 4-vectors D_1[q] n, D_2[q] n, and D_3[q] n contain
%         the same 4 entries, but permuted and possibly negated.
%         Here are those entries

      entry11 =  2.0*(u(20)*u(28) + u(21)*u(29) + u(22)*u(30));
      entry12 =  2.0*(u(21)*u(28) - u(20)*u(29) + u(23)*u(30));
      entry13 =  2.0*(u(22)*u(28) - u(23)*u(29) - u(20)*u(30));
      entry14 =  2.0*(u(23)*u(28) + u(22)*u(29) - u(21)*u(30));

%       Components of D_1[q] n

      d11qn(1) =  entry11;
      d11qn(2) =  -entry12;
      d11qn(3) =  -entry13;
      d11qn(4) =  entry14;

%       Components of D_2[q] n

      d12qn(1) =  entry12;
      d12qn(2) =  entry11;
      d12qn(3) =  -entry14;
      d12qn(4) =  -entry13;

%       Components of D_3[q] n

      d13qn(1) =  entry13;
      d13qn(2) =  entry14;
      d13qn(3) =  entry11;
      d13qn(4) =  entry12;

%       Components of d1

      d11(1)= u(20)*u(20)-u(21)*u(21)-u(22)*u(22)+u(23)*u(23);
      d11(2)= 2.0*u(20)*u(21)+2.0*u(22)*u(23);
      d11(3)= 2.0*u(20)*u(22)-2.0*u(21)*u(23);

%       Components of d2

      d12(1)= 2.0*u(20)*u(21)-2.0*u(22)*u(23);
      d12(2)= -u(20)*u(20)+u(21)*u(21)-u(22)*u(22)+u(23)*u(23);
      d12(3)= 2.0*u(21)*u(22)+2.0*u(20)*u(23);

%       Components of d3
      d13(1)= 2.0*u(20)*u(22)+2.0*u(21)*u(23);
      d13(2)= 2.0*u(21)*u(22)-2.0*u(20)*u(23);
      d13(3)= -u(20)*u(20)-u(21)*u(21)+u(22)*u(22)+u(23)*u(23);

%       Calculate components of the strain
      strain1(1) = m1(1)/k11 + uhat11;
      strain1(2) = m1(2)/k12 + uhat12;
      strain1(3) = m1(3)/k13 + uhat13;
      
%       Now calculate the right hand sides
%       Additional terms      
     
      F(17) = L1*(d13(1));
      F(18) = L1*(d13(2));
      F(19) = L1*(d13(3));
      F(20) = L1*(strain1(1)*u(23)/2.0 - strain1(2)*u(22)/2.0 + strain1(3)*u(21)/2.0);
      F(21) = L1*(strain1(1)*u(22)/2.0 + strain1(2)*u(23)/2.0 - strain1(3)*u(20)/2.0);
      F(22) = L1*(-strain1(1)*u(21)/2.0 + strain1(2)*u(20)/2.0 + strain1(3)*u(23)/2.0);
      F(23) = L1*(-strain1(1)*u(20)/2.0 - strain1(2)*u(21)/2.0 - strain1(3)*u(22)/2.0);
      F(24) = L1*(strain1(1)*u(27)/2.0- strain1(2)*u(26)/2.0 + strain1(3)*u(25)/2.0 -d13qn(1));
      F(25) = L1*(strain1(1)*u(26)/2.0+ strain1(2)*u(27)/2.0-strain1(3)*u(24)/2.0 -d13qn(2));
      F(26) = L1*(-strain1(1)*u(25)/2.0+ strain1(2)*u(24)/2.0+strain1(3)*u(27)/2.0 -d13qn(3));
      F(27) = L1*(-strain1(1)*u(24)/2.0- strain1(2)*u(25)/2.0-strain1(3)*u(26)/2.0 -d13qn(4));
      F(28) = L1*0.0;
      F(29) = L1*0.0;
      F(30) = L1*0.0;
    
      m3(1) = ( u(23+14)*u(24+14) + u(22+14)*u(25+14) - u(21+14)*u(26+14) - u(20+14)*u(27+14))/2.0;
      m3(2) = (-u(22+14)*u(24+14) + u(23+14)*u(25+14) + u(20+14)*u(26+14) - u(21+14)*u(27+14))/2.0;
      m3(3) = ( u(21+14)*u(24+14) - u(20+14)*u(25+14) + u(23+14)*u(26+14) - u(22+14)*u(27+14))/2.0;

%%       The 4-vectors D_1[q] n, D_2[q] n, and D_3[q] n contain
%%         the same 4 entries, but permuted and possibly negated.
%%         Here are those entries

      entry31 =  2.0*(u(20+14)*u(28+14) + u(21+14)*u(29+14) + u(22+14)*u(30+14));
      entry32 =  2.0*(u(21+14)*u(28+14) - u(20+14)*u(29+14) + u(23+14)*u(30+14));
      entry33 =  2.0*(u(22+14)*u(28+14) - u(23+14)*u(29+14) - u(20+14)*u(30+14));
      entry34 =  2.0*(u(23+14)*u(28+14) + u(22+14)*u(29+14) - u(21+14)*u(30+14));

%%       Components of D_3[q] n

      d33qn(1) =  entry33;
      d33qn(2) =  entry34;
      d33qn(3) =  entry31;
      d33qn(4) =  entry32;


%%       Components of d3
      d33(1)= 2.0*u(20+14)*u(22+14) + 2.0*u(21+14)*u(23+14);
      d33(2)= 2.0*u(21+14)*u(22+14) - 2.0*u(20+14)*u(23+14);
      d33(3)= -u(20+14)*u(20+14) - u(21+14)*u(21+14) + u(22+14)*u(22+14) + u(23+14)*u(23+14);
%%       Components of v; note that v(3) has an extra term, due to
%%         the fact that the unstressed state is assumed to have v=[0 0 1].

     ab1=-C2*((u(46) + u(48))/C1 - m3(3)/C1  + u(46)/C2 + uhat23- uhat13 - uhat23); 
     ab2=-C3*((u(46) + u(48))/C1 - m3(3)/C1  + u(48)/C3 + uhat33- uhat13 - uhat33);
    

    ub31=(A1*uhat11 + A2*(uhat21*cos(u(45))- uhat22*sin(u(45)) ) + A3*(uhat31*cos(u(47))- uhat32*sin(u(47))))/(A1+A2+A3);
	ub32=(A1*uhat12 + A2*(uhat21*sin(u(45))+ uhat22*cos(u(45)) ) + A3*(uhat31*sin(u(47))+ uhat32*cos(u(47))))/(A1+A2+A3);
	ub33= (ab1 + ab2 + C1*uhat13)/(C1+C2+C3);

     
	strain3(1) = m3(1)/(A1+A2+A3) + ub31;
	strain3(2) = m3(2)/(A1+A2+A3) + ub32;
	strain3(3) = (m3(3)- u(46) -u(48)) /C1 + uhat13;  

	F(31) = L3*(d33(1));
    F(32) = L3*(d33(2));
	F(33) = L3*(d33(3));
      
	F(34) = L3*( strain3(1)*u(23+14)/2.0 - strain3(2)*u(22+14)/2.0 + strain3(3)*u(21+14)/2.0);
    F(35) = L3*( strain3(1)*u(22+14)/2.0 + strain3(2)*u(23+14)/2.0 - strain3(3)*u(20+14)/2.0);
    F(36) = L3*(-strain3(1)*u(21+14)/2.0 + strain3(2)*u(20+14)/2.0 + strain3(3)*u(23+14)/2.0);
    F(37) = L3*(-strain3(1)*u(20+14)/2.0 - strain3(2)*u(21+14)/2.0 - strain3(3)*u(22+14)/2.0);
     
	F(38) = L3*( strain3(1)*u(27+14)/2.0 - strain3(2)*u(26+14)/2.0 + strain3(3)*u(25+14)/2.0 -d33qn(1));
	F(39) = L3*( strain3(1)*u(26+14)/2.0 + strain3(2)*u(27+14)/2.0 - strain3(3)*u(24+14)/2.0 -d33qn(2));
	F(40) = L3*(-strain3(1)*u(25+14)/2.0 + strain3(2)*u(24+14)/2.0 + strain3(3)*u(27+14)/2.0 -d33qn(3));
	F(41) = L3*(-strain3(1)*u(24+14)/2.0 - strain3(2)*u(25+14)/2.0 - strain3(3)*u(26+14)/2.0 -d33qn(4));
     
	F(42) = L3*0.0;
	F(43) = L3*0.0;
	F(44) = L3*0.0;
   	F(45)= L3*((u(46) + u(48))/C1 - m3(3)/C1  + u(46)/C2 + uhat23- uhat13);  %%%Alfa2=u(45)
	F(46)= L3*(A2*uhat21*(A3*uhat31*sin(u(45)-u(47)) + A1*uhat11*sin(u(45))))/(A1+A2+A3) + L3*A2*uhat21*(m3(1)*sin(u(45)) - m3(2)*cos(u(45)))/(A1+A2+A3);
    F(47)= L3*((u(46) + u(48))/C1 - m3(3)/C1  + u(48)/C3 + uhat33- uhat13);  %%%Alfa3=u(47)
	F(48)= L3*(A3*uhat31*(A2*uhat21*sin(u(47)-u(45)) + A1*uhat11*sin(u(47))))/(A1+A2+A3) + A3*L3*uhat31*(m3(1)*sin(u(47)) - m3(2)*cos(u(47)))/(A1+A2+A3);
      

    NDIM=48;
    jac=zeros(NDIM);
    kb31=A1+A2+A3;
	kb32=A1+A2+A3;
	kb33=C1+C2+C3; 

    e201= -u(7)*u(11)/(4.0*k21)- u(6)*u(10)/(4.0*k22)- u(5)*u(9)/(4.0*C1) + 0.0;                  % 3 rd component only with k23 
	e202= -u(7)*u(10)/(4.0*k21)+ u(6)*u(11)/(4.0*k22)+ u(5)*u(8)/(4.0*C1) + (strain2(3)/2.0);
	e203=  u(7)*u(9)/(4.0*k21) + u(6)*u(8)/(4.0*k22) - u(5)*u(11)/(4.0*C1)- (strain2(2)/2.0);
	e204=  u(7)*u(8)/(4.0*k21) - u(6)*u(9)/(4.0*k22) + u(5)*u(10)/(4.0*C1) + (strain2(1)/2.0);
	%perfect
	e205=  u(7)*u(7)/(4.0*k21) + u(6)*u(6)/(4.0*k22) + u(5)*u(5)/(4.0*C1);
	e206=  u(6)*u(7)/(4.0*k21) - u(7)*u(6)/(4.0*k22) - u(4)*u(5)/(4.0*C1);
	e207= -u(5)*u(7)/(4.0*k21) - u(4)*u(6)/(4.0*k22) + u(7)*u(5)/(4.0*C1);
	e208= -u(4)*u(7)/(4.0*k21) + u(5)*u(6)/(4.0*k22) - u(6)*u(5)/(4.0*C1);
    %Good
    %Changes
	a201= ( A2*u(7)*(-uhat21*sin(u(15)) - uhat22*cos(u(15))) - A2*u(6)*( uhat21*cos(u(15))- uhat22*sin( u(15))) )/(2.0*(A1+A2));
	b201= -u(5)/(2.0*C1);  % -C2/k23 *   2.0 is missing find


    % D q2
	e211= -u(6)*u(11)/(4.0*k21)+ u(7)*u(10)/(4.0*k22)+ u(4)*u(9)/(4.0*C1) - strain2(3)/2.0;
	e212= -u(6)*u(10)/(4.0*k21)- u(7)*u(11)/(4.0*k22)- u(4)*u(8)/(4.0*C1) + 0.0;
	e213=  u(6)*u(9)/(4.0*k21) - u(7)*u(8)/(4.0*k22) + u(4)*u(11)/(4.0*C1) + strain2(1)/2.0;
	e214=  u(6)*u(8)/(4.0*k21) + u(7)*u(9)/(4.0*k22) - u(4)*u(10)/(4.0*C1) + strain2(2)/2.0;
	
	e215=  u(7)*u(6)/(4.0*k21) - u(6)*u(7)/(4.0*k22) - u(5)*u(4)/(4.0*C1);
	e216=  u(6)*u(6)/(4.0*k21) + u(7)*u(7)/(4.0*k22) + u(4)*u(4)/(4.0*C1);
	e217=-u(5)*u(6)/(4.0*k21) + u(4)*u(7)/(4.0*k22) - u(7)*u(4)/(4.0*C1);
	e218=-u(4)*u(6)/(4.0*k21) - u(5)*u(7)/(4.0*k22) + u(6)*u(4)/(4.0*C1);

	a211= ( A2*u(6)*(-uhat21*sin(u(15)) - uhat22*cos(u(15))) + A2*u(7)*(uhat21*cos(u(15))- uhat22*sin(u(15))) )/(2.0*(A1+A2));
	b211= u(4)/(2.0*C1);

    % D q3
	e221= +u(5)*u(11)/(4.0*k21)+ u(4)*u(10)/(4.0*k22) - u(7)*u(9)/(4.0*C1)  + strain2(2)/2.0;
	e222= +u(5)*u(10)/(4.0*k21)- u(4)*u(11)/(4.0*k22) + u(7)*u(8)/(4.0*C1)  - strain2(1)/2.0;
	e223= -u(5)*u(9)/(4.0*k21) - u(4)*u(8)/(4.0*k22)  - u(7)*u(11)/(4.0*C1) + 0.0;
	e224= -u(5)*u(8)/(4.0*k21) + u(4)*u(9)/(4.0*k22)  + u(7)*u(10)/(4.0*C1) + strain2(3)/2.0;
	
	e225= -u(7)*u(5)/(4.0*k21) - u(6)*u(4)/(4.0*k22) + u(5)*u(7)/(4.0*C1);
	e226= -u(6)*u(5)/(4.0*k21) + u(7)*u(4)/(4.0*k22) - u(4)*u(7)/(4.0*C1);
	e227= u(5)*u(5)/(4.0*k21) + u(4)*u(4)/(4.0*k22) + u(7)*u(7)/(4.0*C1);
	e228= u(4)*u(5)/(4.0*k21) - u(5)*u(4)/(4.0*k22) - u(6)*u(7)/(4.0*C1);
	
	a221= (-A2*u(5)*(-uhat21*sin(u(15))-uhat22*cos(u(15)))+ A2*u(4)*(uhat21*cos(u(15))-uhat22*sin( u(15))))/(2.0*(A1+A2));
	b221= -u(7)/(2.0*C1);

	% D q4
	e231= +u(4)*u(11)/(4.0*k21)- u(5)*u(10)/(4.0*k22)+ u(6)*u(9)/(4.0*C1)  - strain2(1)/2.0;
	e232= +u(4)*u(10)/(4.0*k21)+ u(5)*u(11)/(4.0*k22)- u(6)*u(8)/(4.0*C1)  - strain2(2)/2.0;
	e233= -u(4)*u(9)/(4.0*k21) + u(5)*u(8)/(4.0*k22) + u(6)*u(11)/(4.0*C1) - strain2(3)/2.0;
	e234= -u(4)*u(8)/(4.0*k21) - u(5)*u(9)/(4.0*k22) - u(6)*u(10)/(4.0*C1) + 0.0;
	
	e235= -u(7)*u(4)/(4.0*k21) + u(6)*u(5)/(4.0*k22) - u(5)*u(6)/(4.0*C1);
	e236= -u(6)*u(4)/(4.0*k21) - u(7)*u(5)/(4.0*k22) + u(4)*u(6)/(4.0*C1);
	e237=  u(5)*u(4)/(4.0*k21) - u(4)*u(5)/(4.0*k22) - u(7)*u(6)/(4.0*C1);
	e238=  u(4)*u(4)/(4.0*k21) + u(5)*u(5)/(4.0*k22) + u(6)*u(6)/(4.0*C1);
	
	a231=(-A2*u(4)*(-uhat21*sin(u(15))-uhat22*cos(u(15)))- A2*u(5)*(uhat21*cos(u(15))-uhat22*sin( u(15))))/(2.0*(A1+A2));
	b231=u(6)/(2.0*C1);
    %perfect
    %d mu1
	e241= -u(11)*u(11)/(4.0*k21) - u(10)*u(10)/(4.0*k22)- u(9)*u(9)/(4.0*C1) +2.0*u(14);
	e242= -u(11)*u(10)/(4.0*k21) + u(10)*u(11)/(4.0*k22) + u(9)*u(8)/(4.0*C1);
	e243=  u(11)*u(9)/(4.0*k21)  + u(10)*u(8)/(4.0*k22) - u(9)*u(11)/(4.0*C1) -2.0*u(12);
	e244=  u(11)*u(8)/(4.0*k21)  - u(10)*u(9)/(4.0*k22) + u(9)*u(10)/(4.0*C1)  +2.0*u(13);
	
	e245=  u(7)*u(11)/(4.0*k21) + u(6)*u(10)/(4.0*k22) + u(5)*u(9)/(4.0*C1) + 0.0;
	e246=  u(6)*u(11)/(4.0*k21) - u(7)*u(10)/(4.0*k22) - u(4)*u(9)/(4.0*C1) + strain2(3)/2.0;
	e247= -u(5)*u(11)/(4.0*k21) - u(4)*u(10)/(4.0*k22) + u(7)*u(9)/(4.0*C1) - strain2(2)/2.0;
	e248= -u(4)*u(11)/(4.0*k21) + u(5)*u(10)/(4.0*k22) - u(6)*u(9)/(4.0*C1) + strain2(1)/2.0;
	
	a241=(A2*u(11)*(-uhat21*sin(u(15))- uhat22*cos(u(15))) - A2*u(10)*(uhat21*cos(u(15))- uhat22*sin(u(15))) )/(2.0*(A1+A2));
	b241=-u(9)/(2.0*C1);

	%d mu2
	e251= -u(10)*u(11)/(4.0*k21) + u(11)*u(10)/(4.0*k22) + u(8)*u(9)/(4.0*C1);
	e252= -u(10)*u(10)/(4.0*k21) - u(11)*u(11)/(4.0*k22) - u(8)*u(8)/(4.0*C1)  + 2.0*u(14); 
	e253=  u(10)*u(9)/(4.0*k21)  - u(11)*u(8)/(4.0*k22)  + u(8)*u(11)/(4.0*C1) - 2.0*u(13); 	
	e254=  u(10)*u(8)/(4.0*k21)  + u(11)*u(9)/(4.0*k22)  - u(8)*u(10)/(4.0*C1) - 2.0*u(12); 

	e255=  u(7)*u(10)/(4.0*k21) - u(6)*u(11)/(4.0*k22) - u(5)*u(8)/(4.0*C1) - strain2(3)/2.0;
	e256=  u(6)*u(10)/(4.0*k21) + u(7)*u(11)/(4.0*k22) + u(4)*u(8)/(4.0*C1) + 0.0;
	e257= -u(5)*u(10)/(4.0*k21) + u(4)*u(11)/(4.0*k22) - u(7)*u(8)/(4.0*C1) + strain2(1)/2.0;
	e258= -u(4)*u(10)/(4.0*k21) - u(5)*u(11)/(4.0*k22) + u(6)*u(8)/(4.0*C1) + strain2(2)/2.0;
	
	a251=(A2*u(10)*(-uhat21*sin(u(15)) - uhat22*cos(u(15))) + A2*u(11)*(uhat21*cos(u(15))- uhat22*sin(u(15))))/(2.0*(A1+A2));
	b251= u(8)/(2.0*C1);

   %d mu3
	e261= +u(9)*u(11)/(4.0*k21) + u(8)*u(10)/(4.0*k22) - u(11)*u(9)/(4.0*C1) - 2.0*u(12); 
	e262= +u(9)*u(10)/(4.0*k21) - u(8)*u(11)/(4.0*k22) + u(11)*u(8)/(4.0*C1) - 2.0*u(13); 
	e263= -u(9)*u(9)/(4.0*k21)  - u(8)*u(8)/(4.0*k22)  - u(11)*u(11)/(4.0*C1)- 2.0*u(14);  
	e264= -u(9)*u(8)/(4.0*k21)  + u(8)*u(9)/(4.0*k22)  + u(11)*u(10)/(4.0*C1); 
	
	e265= -u(7)*u(9)/(4.0*k21) - u(6)*u(8)/(4.0*k22) + u(5)*u(11)/(4.0*C1) + strain2(2)/2.0;
	e266= -u(6)*u(9)/(4.0*k21) + u(7)*u(8)/(4.0*k22) - u(4)*u(11)/(4.0*C1) - strain2(1)/2.0;
	e267= u(5)*u(9)/(4.0*k21) + u(4)*u(8)/(4.0*k22) + u(7)*u(11)/(4.0*C1) + 0.0;
	e268= u(4)*u(9)/(4.0*k21) - u(5)*u(8)/(4.0*k22) - u(6)*u(11)/(4.0*C1) + strain2(3)/2.0;
	
	a261=(-A2*u(9)*(-uhat21*sin(u(15)) - uhat22*cos(u(15))) + A2*u(8)*(uhat21*cos(u(15))- uhat22*sin(u(15))))/(2.0*(A1+A2));
	b261=-u(11)/(2.0*C1);

   %d mu4
	e271=  u(8)*u(11)/(4.0*k21) - u(9)*u(10)/(4.0*k22) + u(10)*u(9)/(4.0*C1) + 2.0*u(13); 
	e272=  u(8)*u(10)/(4.0*k21) + u(9)*u(11)/(4.0*k22) - u(10)*u(8)/(4.0*C1) - 2.0*u(12); 
	e273= -u(8)*u(9)/(4.0*k21)  + u(9)*u(8)/(4.0*k22)  + u(10)*u(11)/(4.0*C1);
	e274= -u(8)*u(8)/(4.0*k21)  - u(9)*u(9)/(4.0*k22)  - u(10)*u(10)/(4.0*C1)- 2.0*u(14);	
	
	e275= -u(7)*u(8)/(4.0*k21) + u(6)*u(9)/(4.0*k22) - u(5)*u(10)/(4.0*C1) - strain2(1)/2.0;
	e276= -u(6)*u(8)/(4.0*k21) - u(7)*u(9)/(4.0*k22) + u(4)*u(10)/(4.0*C1) - strain2(2)/2.0;
	e277=  u(5)*u(8)/(4.0*k21) - u(4)*u(9)/(4.0*k22) - u(7)*u(10)/(4.0*C1) - strain2(3)/2.0;
	e278=  u(4)*u(8)/(4.0*k21) + u(5)*u(9)/(4.0*k22) + u(6)*u(10)/(4.0*C1) - 0.0;

	a271=(-A2*u(8)*(-uhat21*sin(u(15))- uhat22*cos(u(15))) - A2*u(9)*(uhat21*cos(u(15))- uhat22*sin(u(15))))/(2.0*(A1+A2));
	b271= u(10)/(2.0*C1);
 
     
    % q1=u(4), q(2)=u(5), q(3)= u(6), q(4)= u(7), Mu(1)=u(8), Mu(2)=u(9), Mu(3)=u(10), Mu(4)=u(11)
    afq1= u(9)/(2.0*C1);    %Mu(2)
    afq2=-u(8)/(2.0*C1);    %-Mu(1) 
    afq3= u(11)/(2.0*C1);   % Mu(4)
    afq4=-u(10)/(2.0*C1);    %-Mu(3)
    afm1=-u(5)/(2.0*C1) ;  %-Q(2)
    afm2= u(4)/(2.0*C1);    % Q(1)
    afm3=-u(7)/(2.0*C1);   %-Q(4)
    afm4= u(6)/(2.0*C1);  % Q(3)
       
   
    afb1=(C1+C2)/(C1*C2);
    
   %uhat21 not included
    bq1= ( -u(11)*sin(u(15)) + u(10)*(-cos(u(15))) )*A2*uhat21/(2.0*(A1+A2));  %-Mu(4)    Mu(3)
    bq2= ( -u(10)*sin(u(15)) - u(11)*(-cos(u(15))) )*A2*uhat21/(2.0*(A1+A2));   %-Mu(3)   -Mu(4)
    bq3= (  u(9)*sin(u(15))  - u(8)*( -cos(u(15))) )*A2*uhat21/(2.0*(A1+A2));   % Mu(2)   -Mu(1)
    bq4= (  u(8)*sin(u(15))  + u(9)*( -cos(u(15))) )*A2*uhat21/(2.0*(A1+A2)); % Mu(1     Mu(2)
   
    bm1= (  u(7)*sin(u(15))  - u(6)*(-cos(u(15))))*A2*uhat21/(2.0*(A1+A2));   % q4       -q3
    bm2= (  u(6)*sin(u(15))  + u(7)*(-cos(u(15))))*A2*uhat21/(2.0*(A1+A2));  % q3        q4
    bm3= ( -u(5)*sin(u(15))  + u(4)*(-cos(u(15))))*A2*uhat21/(2.0*(A1+A2));   %-q2        q1
    bm4= ( -u(4)*sin(u(15))  - u(5)*(-cos(u(15))))*A2*uhat21/(2.0*(A1+A2));  %-q1       -q2
    ba1=  A1*A2*uhat11*uhat21*cos(u(15))/(A1+A2) + ( m2(1)*cos(u(15)) + m2(2)*sin(u(15)))*A2*uhat21/(A1+A2); % Pending
    
    
    w201= -u(16+7)*u(16+11)/(4.0*k11)- u(16+6)*u(16+10)/(4.0*k12)- u(16+5)*u(16+9)/(4.0*k13) + 0.0;                  % 3 rd component only with k13 
	w202= -u(16+7)*u(16+10)/(4.0*k11)+ u(16+6)*u(16+11)/(4.0*k12)+ u(16+5)*u(16+8)/(4.0*k13) + (strain1(3)/2.0);
	w203=  u(16+7)*u(16+9)/(4.0*k11) + u(16+6)*u(16+8)/(4.0*k12) - u(16+5)*u(16+11)/(4.0*k13)- (strain1(2)/2.0);
	w204=  u(16+7)*u(16+8)/(4.0*k11) - u(16+6)*u(16+9)/(4.0*k12)+ u(16+5)*u(16+10)/(4.0*k13) + (strain1(1)/2.0);
	%perfect
	w205=  u(16+7)*u(16+7)/(4.0*k11) + u(16+6)*u(16+6)/(4.0*k12) + u(16+5)*u(16+5)/(4.0*k13);
	w206=  u(16+6)*u(16+7)/(4.0*k11) - u(16+7)*u(16+6)/(4.0*k12) - u(16+4)*u(16+5)/(4.0*k13);
	w207= -u(16+5)*u(16+7)/(4.0*k11) - u(16+4)*u(16+6)/(4.0*k12) + u(16+7)*u(16+5)/(4.0*k13);
	w208= -u(16+4)*u(16+7)/(4.0*k11) + u(16+5)*u(16+6)/(4.0*k12) - u(16+6)*u(16+5)/(4.0*k13);


	w211= -u(16+6)*u(16+11)/(4.0*k11)+ u(16+7)*u(16+10)/(4.0*k12)+ u(16+4)*u(16+9)/(4.0*k13) - strain1(3)/2.0;
	w212= -u(16+6)*u(16+10)/(4.0*k11)- u(16+7)*u(16+11)/(4.0*k12)- u(16+4)*u(16+8)/(4.0*k13) + 0.0;
	w213=  u(16+6)*u(16+9)/(4.0*k11) - u(16+7)*u(16+8)/(4.0*k12) + u(16+4)*u(16+11)/(4.0*k13) + strain1(1)/2.0;
	w214=  u(16+6)*u(16+8)/(4.0*k11) + u(16+7)*u(16+9)/(4.0*k12) - u(16+4)*u(16+10)/(4.0*k13) + strain1(2)/2.0;
	
	w215=  u(16+7)*u(16+6)/(4.0*k11) - u(16+6)*u(16+7)/(4.0*k12) - u(16+5)*u(16+4)/(4.0*k13);
	w216=  u(16+6)*u(16+6)/(4.0*k11) + u(16+7)*u(16+7)/(4.0*k12) + u(16+4)*u(16+4)/(4.0*k13);
	w217= -u(16+5)*u(16+6)/(4.0*k11) + u(16+4)*u(16+7)/(4.0*k12) - u(16+7)*u(16+4)/(4.0*k13);
	w218= -u(16+4)*u(16+6)/(4.0*k11) - u(16+5)*u(16+7)/(4.0*k12) + u(16+6)*u(16+4)/(4.0*k13);


	w221= +u(16+5)*u(16+11)/(4.0*k11)+ u(16+4)*u(16+10)/(4.0*k12) - u(16+7)*u(16+9)/(4.0*k13)  + strain1(2)/2.0;
	w222= +u(16+5)*u(16+10)/(4.0*k11)- u(16+4)*u(16+11)/(4.0*k12) + u(16+7)*u(16+8)/(4.0*k13)  - strain1(1)/2.0;
	w223= -u(16+5)*u(16+9)/(4.0*k11) - u(16+4)*u(16+8)/(4.0*k12)  - u(16+7)*u(16+11)/(4.0*k13) + 0.0;
	w224= -u(16+5)*u(16+8)/(4.0*k11) + u(16+4)*u(16+9)/(4.0*k12)  + u(16+7)*u(16+10)/(4.0*k13) + strain1(3)/2.0;
	
	w225= -u(16+7)*u(16+5)/(4.0*k11) - u(16+6)*u(16+4)/(4.0*k12) + u(16+5)*u(16+7)/(4.0*k13);
	w226= -u(16+6)*u(16+5)/(4.0*k11) + u(16+7)*u(16+4)/(4.0*k12) - u(16+4)*u(16+7)/(4.0*k13);
	w227= u(16+5)*u(16+5)/(4.0*k11) + u(16+4)*u(16+4)/(4.0*k12) + u(16+7)*u(16+7)/(4.0*k13);
	w228= u(16+4)*u(16+5)/(4.0*k11) - u(16+5)*u(16+4)/(4.0*k12) - u(16+6)*u(16+7)/(4.0*k13);

	w231= +u(16+4)*u(16+11)/(4.0*k11)- u(16+5)*u(16+10)/(4.0*k12)+ u(16+6)*u(16+9)/(4.0*k13)  - strain1(1)/2.0;
	w232= +u(16+4)*u(16+10)/(4.0*k11)+ u(16+5)*u(16+11)/(4.0*k12)- u(16+6)*u(16+8)/(4.0*k13)  - strain1(2)/2.0;	
	w233= -u(16+4)*u(16+9)/(4.0*k11) + u(16+5)*u(16+8)/(4.0*k12) + u(16+6)*u(16+11)/(4.0*k13) - strain1(3)/2.0;
	w234= -u(16+4)*u(16+8)/(4.0*k11) - u(16+5)*u(16+9)/(4.0*k12) - u(16+6)*u(16+10)/(4.0*k13) + 0.0;
	
	w235= -u(16+7)*u(16+4)/(4.0*k11) + u(16+6)*u(16+5)/(4.0*k12) - u(16+5)*u(16+6)/(4.0*k13);
	w236= -u(16+6)*u(16+4)/(4.0*k11) - u(16+7)*u(16+5)/(4.0*k12) + u(16+4)*u(16+6)/(4.0*k13);
	w237=  u(16+5)*u(16+4)/(4.0*k11) - u(16+4)*u(16+5)/(4.0*k12) - u(16+7)*u(16+6)/(4.0*k13);
	w238=  u(16+4)*u(16+4)/(4.0*k11) + u(16+5)*u(16+5)/(4.0*k12) + u(16+6)*u(16+6)/(4.0*k13);
     
	w241= -u(16+11)*u(16+11)/(4.0*k11) - u(16+10)*u(16+10)/(4.0*k12)- u(16+9)*u(16+9)/(4.0*k13) +2.0*u(16+14);
	w242= -u(16+11)*u(16+10)/(4.0*k11) + u(16+10)*u(16+11)/(4.0*k12) + u(16+9)*u(16+8)/(4.0*k13);
	w243=  u(16+11)*u(16+9)/(4.0*k11)  + u(16+10)*u(16+8)/(4.0*k12) - u(16+9)*u(16+11)/(4.0*k13) -2.0*u(16+12);
	w244=  u(16+11)*u(16+8)/(4.0*k11) - u(16+10)*u(16+9)/(4.0*k12) + u(16+9)*u(16+10)/(4.0*k13)  +2.0*u(16+13);
	
	w245=  u(16+7)*u(16+11)/(4.0*k11) + u(16+6)*u(16+10)/(4.0*k12) + u(16+5)*u(16+9)/(4.0*k13) + 0.0;
	w246=  u(16+6)*u(16+11)/(4.0*k11) - u(16+7)*u(16+10)/(4.0*k12) - u(16+4)*u(16+9)/(4.0*k13) + strain1(3)/2.0;
	w247= -u(16+5)*u(16+11)/(4.0*k11) - u(16+4)*u(16+10)/(4.0*k12) + u(16+7)*u(16+9)/(4.0*k13) - strain1(2)/2.0;
	w248= -u(16+4)*u(16+11)/(4.0*k11) + u(16+5)*u(16+10)/(4.0*k12) - u(16+6)*u(16+9)/(4.0*k13) + strain1(1)/2.0;
	
	w251= -u(16+10)*u(16+11)/(4.0*k11) + u(16+11)*u(16+10)/(4.0*k12) + u(16+8)*u(16+9)/(4.0*k13);
	w252= -u(16+10)*u(16+10)/(4.0*k11) - u(16+11)*u(16+11)/(4.0*k12) - u(16+8)*u(16+8)/(4.0*k13)  + 2.0*u(16+14); 
	w253=  u(16+10)*u(16+9)/(4.0*k11)  - u(16+11)*u(16+8)/(4.0*k12)  + u(16+8)*u(16+11)/(4.0*k13) - 2.0*u(16+13);  	
	w254=  u(16+10)*u(16+8)/(4.0*k11)  + u(16+11)*u(16+9)/(4.0*k12)  - u(16+8)*u(16+10)/(4.0*k13) - 2.0*u(16+12); 

	w255=  u(16+7)*u(16+10)/(4.0*k11) - u(16+6)*u(16+11)/(4.0*k12) - u(16+5)*u(16+8)/(4.0*k13) - strain1(3)/2.0;
	w256=  u(16+6)*u(16+10)/(4.0*k11) + u(16+7)*u(16+11)/(4.0*k12) + u(16+4)*u(16+8)/(4.0*k13) + 0.0;
	w257= -u(16+5)*u(16+10)/(4.0*k11) + u(16+4)*u(16+11)/(4.0*k12) - u(16+7)*u(16+8)/(4.0*k13) + strain1(1)/2.0;
	w258= -u(16+4)*u(16+10)/(4.0*k11) - u(16+5)*u(16+11)/(4.0*k12) + u(16+6)*u(16+8)/(4.0*k13) + strain1(2)/2.0;
	
	w261= +u(16+9)*u(16+11)/(4.0*k11) + u(16+8)*u(16+10)/(4.0*k12) - u(16+11)*u(16+9)/(4.0*k13) - 2.0*u(16+12); 
	w262= +u(16+9)*u(16+10)/(4.0*k11) - u(16+8)*u(16+11)/(4.0*k12) + u(16+11)*u(16+8)/(4.0*k13) - 2.0*u(16+13); 
	w263= -u(16+9)*u(16+9)/(4.0*k11)  - u(16+8)*u(16+8)/(4.0*k12)  - u(16+11)*u(16+11)/(4.0*k13)- 2.0*u(16+14);  
	w264= -u(16+9)*u(16+8)/(4.0*k11)  + u(16+8)*u(16+9)/(4.0*k12)  + u(16+11)*u(16+10)/(4.0*k13);
	
	w265= -u(16+7)*u(16+9)/(4.0*k11) - u(16+6)*u(16+8)/(4.0*k12) + u(16+5)*u(16+11)/(4.0*k13) + strain1(2)/2.0;
	w266= -u(16+6)*u(16+9)/(4.0*k11) + u(16+7)*u(16+8)/(4.0*k12) - u(16+4)*u(16+11)/(4.0*k13) - strain1(1)/2.0;
	w267=  u(16+5)*u(16+9)/(4.0*k11) + u(16+4)*u(16+8)/(4.0*k12) + u(16+7)*u(16+11)/(4.0*k13) + 0.0;
	w268=  u(16+4)*u(16+9)/(4.0*k11) - u(16+5)*u(16+8)/(4.0*k12) - u(16+6)*u(16+11)/(4.0*k13) + strain1(3)/2.0;
	
	w271=  u(16+8)*u(16+11)/(4.0*k11) - u(16+9)*u(16+10)/(4.0*k12) + u(16+10)*u(16+9)/(4.0*k13) + 2.0*u(16+13); 
	w272=  u(16+8)*u(16+10)/(4.0*k11) + u(16+9)*u(16+11)/(4.0*k12) - u(16+10)*u(16+8)/(4.0*k13) - 2.0*u(16+12); 
	w273= -u(16+8)*u(16+9)/(4.0*k11)  + u(16+9)*u(16+8)/(4.0*k12)  + u(16+10)*u(16+11)/(4.0*k13);
	w274= -u(16+8)*u(16+8)/(4.0*k11)  - u(16+9)*u(16+9)/(4.0*k12)  - u(16+10)*u(16+10)/(4.0*k13)- 2.0*u(16+14);  	
	
	w275= -u(16+7)*u(16+8)/(4.0*k11) + u(16+6)*u(16+9)/(4.0*k12) - u(16+5)*u(16+10)/(4.0*k13) - strain1(1)/2.0;
	w276= -u(16+6)*u(16+8)/(4.0*k11) - u(16+7)*u(16+9)/(4.0*k12) + u(16+4)*u(16+10)/(4.0*k13) - strain1(2)/2.0;
	w277=  u(16+5)*u(16+8)/(4.0*k11) - u(16+4)*u(16+9)/(4.0*k12) - u(16+7)*u(16+10)/(4.0*k13) - strain1(3)/2.0;
	w278=  u(16+4)*u(16+8)/(4.0*k11) + u(16+5)*u(16+9)/(4.0*k12) + u(16+6)*u(16+10)/(4.0*k13) - 0.0;

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% t: for three-tube
	t201= -u(37)*u(41)/(4.0*kb31) - u(36)*u(40)/(4.0*kb32)- u(35)*u(39)/(4.0*C1)+ 0.0;                  % 3 rd component only with k2
	t202= -u(37)*u(40)/(4.0*kb31) + u(36)*u(41)/(4.0*kb32)+ u(35)*u(38)/(4.0*C1)+ (strain3(3)/2.0);
	t203=  u(37)*u(39)/(4.0*kb31) + u(36)*u(38)/(4.0*kb32)- u(35)*u(41)/(4.0*C1)- (strain3(2)/2.0);
	t204=  u(37)*u(38)/(4.0*kb31) - u(36)*u(39)/(4.0*kb32)+ u(35)*u(40)/(4.0*C1)+ (strain3(1)/2.0);
	%perfect
	t205=  u(37)*u(37)/(4.0*kb31) + u(36)*u(36)/(4.0*kb32) + u(35)*u(35)/(4.0*C1);
	t206=  u(36)*u(37)/(4.0*kb31) - u(37)*u(36)/(4.0*kb32) - u(34)*u(35)/(4.0*C1);
	t207= -u(35)*u(37)/(4.0*kb31) - u(34)*u(36)/(4.0*kb32) + u(37)*u(35)/(4.0*C1);
	t208= -u(34)*u(37)/(4.0*kb31) + u(35)*u(36)/(4.0*kb32) - u(36)*u(35)/(4.0*C1);

	at201= ( A2*u(37)*(-uhat21*sin(u(45)) - uhat22*cos(u(45))) - A2*u(36)*( uhat21*cos(u(45))- uhat22*sin( u(45))) )/(2.0*(A1+A2+A3));
	at202= ( A3*u(37)*(-uhat31*sin(u(47)) - uhat32*cos(u(47))) - A3*u(36)*( uhat31*cos(u(47))- uhat32*sin( u(47))) )/(2.0*(A1+A2+A3));
	
	%bt201= u(35)*(-C2*(1/C1 + 1/C2) - C3*(1/C1))/(C1+C2+C3) 
	bt201= -u(35)/(2.0*C1);
	%bt202= u(35)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(C1+C2+C3)
	bt202= -u(35)/(2.0*C1);
	   % D q2
	t211= -u(36)*u(41)/(4.0*kb31)+ u(37)*u(40)/(4.0*kb32)+ u(34)*u(39)/(4.0*C1) - strain3(3)/2.0;
	t212= -u(36)*u(40)/(4.0*kb31)- u(37)*u(41)/(4.0*kb32)- u(34)*u(38)/(4.0*C1) + 0.0;
	t213=  u(36)*u(39)/(4.0*kb31) - u(37)*u(38)/(4.0*kb32) + u(34)*u(41)/(4.0*C1) + strain3(1)/2.0;
	t214=  u(36)*u(38)/(4.0*kb31) + u(37)*u(39)/(4.0*kb32) - u(34)*u(40)/(4.0*C1) + strain3(2)/2.0;
	
	t215=  u(37)*u(36)/(4.0*kb31) - u(36)*u(37)/(4.0*kb32) - u(35)*u(34)/(4.0*C1);
	t216=  u(36)*u(36)/(4.0*kb31) + u(37)*u(37)/(4.0*kb32) + u(34)*u(34)/(4.0*C1);
	t217= -u(35)*u(36)/(4.0*kb31) + u(34)*u(37)/(4.0*kb32) - u(37)*u(34)/(4.0*C1);
	t218= -u(34)*u(36)/(4.0*kb31) - u(35)*u(37)/(4.0*kb32) + u(36)*u(34)/(4.0*C1);

	at211= ( A2*u(36)*(-uhat21*sin(u(45)) - uhat22*cos(u(45))) + A2*u(37)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at212= ( A3*u(36)*(-uhat31*sin(u(47)) - uhat32*cos(u(47))) + A3*u(37)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
	
	%bt211= -u(34)*(-C2*(1/C1 + 1/C2) - C3*(1/C1))/(C1+C2+C3) 
	%bt212= -u(34)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(C1+C2+C3)
	
	bt211= u(34)/(2.0*C1);
	bt212= u(34)/(2.0*C1);


    % D q3
	t221= +u(35)*u(41)/(4.0*kb31) + u(34)*u(40)/(4.0*kb32) - u(37)*u(39)/(4.0*C1)  + strain3(2)/2.0;
	t222= +u(35)*u(40)/(4.0*kb31) - u(34)*u(41)/(4.0*kb32) + u(37)*u(38)/(4.0*C1)  - strain3(1)/2.0;
	t223= -u(35)*u(39)/(4.0*kb31) - u(34)*u(38)/(4.0*kb32) - u(37)*u(41)/(4.0*C1) + 0.0;
	t224= -u(35)*u(38)/(4.0*kb31) + u(34)*u(39)/(4.0*kb32) + u(37)*u(40)/(4.0*C1) + strain3(3)/2.0;
	
	t225= -u(37)*u(35)/(4.0*kb31) - u(36)*u(34)/(4.0*kb32) + u(35)*u(37)/(4.0*C1);
	t226= -u(36)*u(35)/(4.0*kb31) + u(37)*u(34)/(4.0*kb32) - u(34)*u(37)/(4.0*C1);
	t227=  u(35)*u(35)/(4.0*kb31) + u(34)*u(34)/(4.0*kb32) + u(37)*u(37)/(4.0*C1);
	t228=  u(34)*u(35)/(4.0*kb31) - u(35)*u(34)/(4.0*kb32) - u(36)*u(37)/(4.0*C1);
	

	at221= (-A2*u(35)*(-uhat21*sin(u(45)) - uhat22*cos(u(45))) + A2*u(34)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at222= (-A3*u(35)*(-uhat31*sin(u(47)) - uhat32*cos(u(47))) + A3*u(34)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
	
	%bt221= u(37)*(-C2*(1/C1 + 1/C2) -C3*(1/C1))/(2.0*(C1+C2+C3)) 
	%bt222= u(37)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(2.0*(C1+C2+C3)) 
	bt221=-u(37)/(2.0*C1);
	bt222=-u(37)/(2.0*C1);

	% D q4
	t231= +u(34)*u(41)/(4.0*kb31)- u(35)*u(40)/(4.0*kb32)+ u(36)*u(39)/(4.0*C1)  - strain3(1)/2.0;
	t232= +u(34)*u(40)/(4.0*kb31)+ u(35)*u(41)/(4.0*kb32)- u(36)*u(38)/(4.0*C1)  - strain3(2)/2.0;	
	t233= -u(34)*u(39)/(4.0*kb31) + u(35)*u(38)/(4.0*kb32) + u(36)*u(41)/(4.0*C1) - strain3(3)/2.0;
	t234= -u(34)*u(38)/(4.0*kb31) - u(35)*u(39)/(4.0*kb32) - u(36)*u(40)/(4.0*C1) + 0.0;
	
	t235= -u(37)*u(34)/(4.0*kb31) + u(36)*u(35)/(4.0*kb32) - u(35)*u(36)/(4.0*C1);
	t236= -u(36)*u(34)/(4.0*kb31) - u(37)*u(35)/(4.0*kb32) + u(34)*u(36)/(4.0*C1);
	t237=  u(35)*u(34)/(4.0*kb31) - u(34)*u(35)/(4.0*kb32) - u(37)*u(36)/(4.0*C1);
	t238=  u(34)*u(34)/(4.0*kb31) + u(35)*u(35)/(4.0*kb32) + u(36)*u(36)/(4.0*C1);
	

	at231= (-A2*u(34)*(-uhat21*sin(u(45)) - uhat22*cos(u(45))) - A2*u(35)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at232= (-A3*u(34)*(-uhat31*sin(u(47)) - uhat32*cos(u(47))) - A3*u(35)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
	
	%bt231= -u(36)*(-C2*(1/C1 + 1/C2) -C3*(1/C1))/(2.0*(C1+C2+C3)) 
	%bt232= -u(36)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(2.0*(C1+C2+C3)) 
	bt231= u(36)/(2.0*C1);
	bt232= u(36)/(2.0*C1);
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%% 
	
	t241= -u(41)*u(41)/(4.0*kb31) - u(40)*u(40)/(4.0*kb32)- u(39)*u(39)/(4.0*C1) + 2.0*u(44);
	t242= -u(41)*u(40)/(4.0*kb31) + u(40)*u(41)/(4.0*kb32) + u(39)*u(38)/(4.0*C1);
	t243=  u(41)*u(39)/(4.0*kb31)  + u(40)*u(38)/(4.0*kb32) - u(39)*u(41)/(4.0*C1) -2.0*u(42);
	t244=  u(41)*u(38)/(4.0*kb31) - u(40)*u(39)/(4.0*kb32) + u(39)*u(40)/(4.0*C1)  +2.0*u(43);
	
	t245=  u(37)*u(41)/(4.0*kb31) + u(36)*u(40)/(4.0*kb32) + u(35)*u(39)/(4.0*C1) + 0.0;
	t246=  u(36)*u(41)/(4.0*kb31) - u(37)*u(40)/(4.0*kb32) - u(34)*u(39)/(4.0*C1) + strain3(3)/2.0;
	t247= -u(35)*u(41)/(4.0*kb31) - u(34)*u(40)/(4.0*kb32) + u(37)*u(39)/(4.0*C1) - strain3(2)/2.0;
	t248= -u(34)*u(41)/(4.0*kb31) + u(35)*u(40)/(4.0*kb32) - u(36)*u(39)/(4.0*C1) + strain3(1)/2.0;
	
	at241=(A2*u(41)*(-uhat21*sin(u(45))- uhat22*cos(u(45))) - A2*u(40)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at242=(A3*u(41)*(-uhat31*sin(u(47))- uhat32*cos(u(47))) - A3*u(40)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
	
	bt241= -u(39)/(2.0*C1);
	bt242= -u(39)/(2.0*C1);

	%d mu2
	t251= -u(40)*u(41)/(4.0*kb31) + u(41)*u(40)/(4.0*kb32) + u(38)*u(39)/(4.0*C1);
	t252= -u(40)*u(40)/(4.0*kb31) - u(41)*u(41)/(4.0*kb32) - u(38)*u(38)/(4.0*C1)  + 2.0*u(44); 
	t253=  u(40)*u(39)/(4.0*kb31)  - u(41)*u(38)/(4.0*kb32)  + u(38)*u(41)/(4.0*C1) - 2.0*u(43);  	
	t254=  u(40)*u(38)/(4.0*kb31)  + u(41)*u(39)/(4.0*kb32)  - u(38)*u(40)/(4.0*C1) - 2.0*u(42);

	t255=  u(37)*u(40)/(4.0*kb31) - u(36)*u(41)/(4.0*kb32) - u(35)*u(38)/(4.0*C1) - strain3(3)/2.0;
	t256=  u(36)*u(40)/(4.0*kb31) + u(37)*u(41)/(4.0*kb32) + u(34)*u(38)/(4.0*C1) + 0.0;
	t257= -u(35)*u(40)/(4.0*kb31) + u(34)*u(41)/(4.0*kb32) - u(37)*u(38)/(4.0*C1) + strain3(1)/2.0;
	t258= -u(34)*u(40)/(4.0*kb31) - u(35)*u(41)/(4.0*kb32) + u(36)*u(38)/(4.0*C1) + strain3(2)/2.0;

	
	at251=(A2*u(40)*(-uhat21*sin(u(45))- uhat22*cos(u(45))) + A2*u(41)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at252=(A3*u(40)*(-uhat31*sin(u(47))- uhat32*cos(u(47))) + A3*u(41)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
	%bt251= -u(38)*(-C2*(1/C1 + 1/C2) -C3*(1/C1))/(2.0*(C1+C2+C3))  
	%bt252= -u(38)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(2.0*(C1+C2+C3)) 
	bt251=  u(38)/(2.0*C1);
	bt252=  u(38)/(2.0*C1);
	

   %d mu3
	t261= +u(39)*u(41)/(4.0*kb31) + u(38)*u(40)/(4.0*kb32) - u(41)*u(39)/(4.0*C1) - 2.0*u(42); 
	t262= +u(39)*u(40)/(4.0*kb31) - u(38)*u(41)/(4.0*kb32) + u(41)*u(38)/(4.0*C1) - 2.0*u(43); 
	t263= -u(39)*u(39)/(4.0*kb31)  - u(38)*u(38)/(4.0*kb32)  - u(41)*u(41)/(4.0*C1)- 2.0*u(44); 
	t264= -u(39)*u(38)/(4.0*kb31)  + u(38)*u(39)/(4.0*kb32)  + u(41)*u(40)/(4.0*C1); 
	
	t265= -u(37)*u(39)/(4.0*kb31) - u(36)*u(38)/(4.0*kb32) + u(35)*u(41)/(4.0*C1) + strain3(2)/2.0;
	t266= -u(36)*u(39)/(4.0*kb31) + u(37)*u(38)/(4.0*kb32) - u(34)*u(41)/(4.0*C1) - strain3(1)/2.0;
	t267= u(35)*u(39)/(4.0*kb31) + u(34)*u(38)/(4.0*kb32) + u(37)*u(41)/(4.0*C1) + 0.0;
	t268= u(34)*u(39)/(4.0*kb31) - u(35)*u(38)/(4.0*kb32) - u(36)*u(41)/(4.0*C1) + strain3(3)/2.0;

	
	at261=(-A2*u(39)*(-uhat21*sin(u(45))- uhat22*cos(u(45))) + A2*u(38)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at262=(-A3*u(39)*(-uhat31*sin(u(47))- uhat32*cos(u(47))) + A3*u(38)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));
		
	%bt261= u(41)*(-C2*(1/C1 + 1/C2) -C3*(1/C1))/(2.0*(C1+C2+C3)) 
	%bt262= u(41)*(-C2*(1/C1) - C3*(1/C1 + 1/C3))/(2.0*(C1+C2+C3)) 
	
	bt261= -u(41)/(2.0*C1);
	bt262= -u(41)/(2.0*C1);

   %d mu4
	t271=  u(38)*u(41)/(4.0*kb31) - u(39)*u(40)/(4.0*kb32) + u(40)*u(39)/(4.0*C1) + 2.0*u(43); 
	t272=  u(38)*u(40)/(4.0*kb31) + u(39)*u(41)/(4.0*kb32) - u(40)*u(38)/(4.0*C1) - 2.0*u(42); 
	t273= -u(38)*u(39)/(4.0*kb31)  + u(39)*u(38)/(4.0*kb32)  + u(40)*u(41)/(4.0*C1);
	t274= -u(38)*u(38)/(4.0*kb31)  - u(39)*u(39)/(4.0*kb32)  - u(40)*u(40)/(4.0*C1)- 2.0*u(44);  	
	
	t275= -u(37)*u(38)/(4.0*kb31) + u(36)*u(39)/(4.0*kb32) - u(35)*u(40)/(4.0*C1) - strain3(1)/2.0;
	t276= -u(36)*u(38)/(4.0*kb31) - u(37)*u(39)/(4.0*kb32) + u(34)*u(40)/(4.0*C1) - strain3(2)/2.0;
	t277=  u(35)*u(38)/(4.0*kb31) - u(34)*u(39)/(4.0*kb32) - u(37)*u(40)/(4.0*C1) - strain3(3)/2.0;
	t278=  u(34)*u(38)/(4.0*kb31) + u(35)*u(39)/(4.0*kb32) + u(36)*u(40)/(4.0*C1) - 0.0;
	
	at271=(-A2*u(38)*(-uhat21*sin(u(45))- uhat22*cos(u(45))) - A2*u(39)*(uhat21*cos(u(45))- uhat22*sin(u(45))) )/(2.0*(A1+A2+A3));
	at272=(-A3*u(38)*(-uhat31*sin(u(47))- uhat32*cos(u(47))) - A3*u(39)*(uhat31*cos(u(47))- uhat32*sin(u(47))) )/(2.0*(A1+A2+A3));

	%bt271= -u(40)*(-C2*(1/C1 + 1/C2) -C3*(1/C1))/(2.0*(C1+C2+C3))  
	%bt272= -u(40)*(-C2*(1/C1)- C3*(1/C1 + 1/C3))/(2.0*(C1+C2+C3)) 
	bt271= u(40)/(2.0*C1);
	bt272= u(40)/(2.0*C1);
	
	
	af2q1= u(39)/(2.0*C1);   % Mu(2)
    af2q2=-u(38)/(2.0*C1);   %-Mu(1) 
    af2q3= u(41)/(2.0*C1);   % Mu(4)
    af2q4=-u(40)/(2.0*C1);   %-Mu(3)
    af2m1=-u(35)/(2.0*C1);   %-Q(2)
    af2m2=+u(34)/(2.0*C1);   % Q(1)
    af2m3=-u(37)/(2.0*C1);   %-Q(4)
    af2m4= u(36)/(2.0*C1);   % Q(3)

    af2b2=(1/C1 + 1/C2);
    af2b3=1/C1;
	
	af3q1= u(39)/(2.0*C1);     % Mu(2)
    af3q2=-u(38)/(2.0*C1);     %-Mu(1) 
    af3q3= u(41)/(2.0*C1);     % Mu(4)
    af3q4=-u(40)/(2.0*C1);     %-Mu(3)
    
    af3m1=-u(35)/(2.0*C1);   %-Q(2)
    af3m2=+u(34)/(2.0*C1);   % Q(1)
    af3m3=-u(37)/(2.0*C1);   %-Q(4)
    af3m4= u(36)/(2.0*C1);   % Q(3)

    af3b2= 1/C1;
    af3b3= 1/C1 + 1/C3;
	
	b2q1= ( -u(41)*sin(u(45)) + u(40)*(-cos(u(45))) )*A2*uhat21/(2.0*(A1+A2+A3));  %-Mu(4)    Mu(3)
    b2q2= ( -u(40)*sin(u(45)) - u(41)*(-cos(u(45))) )*A2*uhat21/(2.0*(A1+A2+A3));   %-Mu(3)   -Mu(4)
    b2q3= (  u(39)*sin(u(45)) - u(38)*(-cos(u(45))) )*A2*uhat21/(2.0*(A1+A2+A3));   % Mu(2)   -Mu(1)
    b2q4= (  u(38)*sin(u(45)) + u(39)*(-cos(u(45))) )*A2*uhat21/(2.0*(A1+A2+A3)); % Mu(1     Mu(2)
   
    b2m1= (  u(37)*sin(u(45))  - u(36)*(-cos(u(45))))*A2*uhat21/(2.0*(A1+A2+A3));   % q4       -q3
    b2m2= (  u(36)*sin(u(45))  + u(37)*(-cos(u(45))))*A2*uhat21/(2.0*(A1+A2+A3));  % q3        q4
    b2m3= ( -u(35)*sin(u(45))  + u(34)*(-cos(u(45))))*A2*uhat21/(2.0*(A1+A2+A3));   %-q2        q1
    b2m4= ( -u(34)*sin(u(45))  - u(35)*(-cos(u(45))))*A2*uhat21/(2.0*(A1+A2+A3));  %-q1       -q2
	
	b2a2=A2*uhat21*(A1*uhat11*cos(u(45)) + A3*uhat31*cos(u(45) - u(47)))/(A1+A2+A3)  + A2*uhat21*(m3(1)*cos(u(45)) + m3(2)*sin(u(45)))/(A1+A2+A3);
	b2a3=A2*uhat21*(-A3*uhat31*cos(u(45) - u(47)))/(A1+A2+A3);
		
	b3q1= ( -u(41)*sin(u(47)) + u(40)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));  	%-Mu(4)    Mu(3)
    b3q2= ( -u(40)*sin(u(47)) - u(41)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));    %-Mu(3)   -Mu(4)
    b3q3= (  u(39)*sin(u(47)) - u(38)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));    % Mu(2)   -Mu(1)
    b3q4= (  u(38)*sin(u(47)) + u(39)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3)); 	% Mu(1     Mu(2)
   
    b3m1= (  u(37)*sin(u(47))  - u(36)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));   % q4       -q3
    b3m2= (  u(36)*sin(u(47))  + u(37)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));   % q3        q4
    b3m3= ( -u(35)*sin(u(47))  + u(34)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));   %-q2        q1
    b3m4= ( -u(34)*sin(u(47))  - u(35)*(-cos(u(47))))*A3*uhat31/(2.0*(A1+A2+A3));   %-q1       -q2
       
    b3a2=A3*uhat31*(-A2*uhat21*cos(u(47) - u(45)))/(A1+A2+A3);
    b3a3=A3*uhat31*(A1*uhat11*cos(u(47)) + A2*uhat21*cos(u(47) - u(45)))/(A1+A2+A3) + A3*uhat31*(m3(1)*cos(u(47)) + m3(2)*sin(u(47)))/(A1+A2+A3);
  
    jac(1,4:7)=2.0*L2*[ u(6), u(7), u(4), u(5)];
    jac(2,4:7)=2.0*L2*[-u(7), u(6), u(5),-u(4)];
    jac(3,4:7)=2.0*L2*[-u(4),-u(5), u(6), u(7)];
    jac(4,4:16)=L2*[e201,e202,e203,e204,e205,e206,e207,e208,0,0,0,a201,b201];
    jac(5,4:16)=L2*[e211,e212,e213,e214,e215,e216,e217,e218,0,0,0,a211,b211];
    jac(6,4:16)=L2*[e221,e222,e223,e224,e225,e226,e227,e228,0,0,0,a221,b221];
    jac(7,4:16)=L2*[e231,e232,e233,e234,e235,e236,e237,e238,0,0,0,a231,b231];
    
    jac(8,4:16)= L2*[e241,e242,e243,e244,e245,e246,e247,e248,-2.0*u(6), 2.0*u(7), 2.0*u(4),a241,b241];
    jac(9,4:16)= L2*[e251,e252,e253,e254,e255,e256,e257,e258,-2.0*u(7),-2.0*u(6), 2.0*u(5),a251,b251];
    jac(10,4:16)=L2*[e261,e262,e263,e264,e265,e266,e267,e268,-2.0*u(4),-2.0*u(5),-2.0*u(6),a261,b261];
    jac(11,4:16)=L2*[e271,e272,e273,e274,e275,e276,e277,e278,-2.0*u(5), 2.0*u(4),-2.0*u(7),a271,b271];
    
    jac(15,4:16)=L2*[afq1,afq2,afq3,afq4,afm1,afm2,afm3,afm4,0,0,0,0,afb1];
    jac(16,4:16)=L2*[bq1,bq2,bq3,bq4,bm1,bm2,bm3,bm4,0,0,0,ba1,0];
    
    
    jac(17,20:23)=L1*2.0*[ u(22), u(23), u(20), u(21)];
    jac(18,20:23)=L1*2.0*[-u(23), u(22), u(21),-u(20)];
    jac(19,20:23)=L1*2.0*[-u(20),-u(21), u(22), u(23)];
    
    
    jac(20,20:27)=L1*[w201,w202,w203,w204,w205,w206,w207,w208];
    jac(21,20:27)=L1*[w211,w212,w213,w214,w215,w216,w217,w218];
    jac(22,20:27)=L1*[w221,w222,w223,w224,w225,w226,w227,w228];
    jac(23,20:27)=L1*[w231,w232,w233,w234,w235,w236,w237,w238];
    
    jac(24,20:30)=L1*[w241,w242,w243,w244,w245,w246,w247,w248,-2.0*u(22), 2.0*u(23), 2.0*u(20)];
    jac(25,20:30)=L1*[w251,w252,w253,w254,w255,w256,w257,w258,-2.0*u(23),-2.0*u(22), 2.0*u(21)];
    jac(26,20:30)=L1*[w261,w262,w263,w264,w265,w266,w267,w268,-2.0*u(20),-2.0*u(21),-2.0*u(22)];
    jac(27,20:30)=L1*[w271,w272,w273,w274,w275,w276,w277,w278,-2.0*u(21), 2.0*u(20),-2.0*u(23)];
    
    jac(31,34:37)=L3*2.0*[ u(36), u(37), u(34), u(35)];
    jac(32,34:37)=L3*2.0*[-u(37), u(36), u(35),-u(34)];
    jac(33,34:37)=L3*2.0*[-u(34),-u(35), u(36), u(37)];
    
    jac(34,34:48)=L3*[t201,t202,t203,t204,t205,t206,t207,t208,0,0,0,at201,bt201,at202,bt202];
    jac(35,34:48)=L3*[t211,t212,t213,t214,t215,t216,t217,t218,0,0,0,at211,bt211,at212,bt212];
    jac(36,34:48)=L3*[t221,t222,t223,t224,t225,t226,t227,t228,0,0,0,at221,bt221,at222,bt222];
    jac(37,34:48)=L3*[t231,t232,t233,t234,t235,t236,t237,t238,0,0,0,at231,bt231,at232,bt232];
    
    jac(38,34:48)=L3*[t241,t242,t243,t244,t245,t246,t247,t248,-2.0*u(36), 2.0*u(37), 2.0*u(34),at241,bt241,at242,bt242];
    jac(39,34:48)=L3*[t251,t252,t253,t254,t255,t256,t257,t258,-2.0*u(37),-2.0*u(36), 2.0*u(35),at251,bt251,at252,bt252];
    jac(40,34:48)=L3*[t261,t262,t263,t264,t265,t266,t267,t268,-2.0*u(34),-2.0*u(35),-2.0*u(36),at261,bt261,at262,bt262];
    jac(41,34:48)=L3*[t271,t272,t273,t274,t275,t276,t277,t278,-2.0*u(35), 2.0*u(34),-2.0*u(37),at271,bt271,at272,bt272];
    
    jac(45,34:48)=L3*[af2q1,af2q2,af2q3,af2q4,af2m1,af2m2,af2m3,af2m4,0,0,0,0,af2b2,0,af2b3];
    jac(46,34:48)=L3*[b2q1,b2q2,b2q3,b2q4,b2m1,b2m2,b2m3,b2m4,0,0,0,b2a2,0,b2a3,0];
    jac(47,34:48)=L3*[af3q1,af3q2,af3q3,af3q4,af3m1,af3m2,af3m3,af3m4,0,0,0,0,af3b2,0,af3b3];
    jac(48,34:48)=L3*[b3q1,b3q2,b3q3,b3q4,b3m1,b3m2,b3m3,b3m4,0,0,0,b3a2,0,b3a3,0];
    
end